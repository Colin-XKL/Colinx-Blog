---
title:  HuginnæŒ‡å—ï¼šä¸ºä»»æ„ç½‘ç«™åˆ¶ä½œRSS
date: 2022-05-08
lastmod: 2022-05-08
description: åˆä¸€ç¯‡ä»‹ç»ä½¿ç”¨Huginnåˆ¶ä½œRSSçš„æ•™ç¨‹ğŸ•¶ï¸
categories:
- æŠ€æœ¯
- æŒ‡å—
tags:
- Huginn
- RSS
- çˆ¬è™«
- CSS
- æŠ€æœ¯
---

<!-- # HuginnæŒ‡å—ï¼šä¸ºä»»æ„ç½‘ç«™åˆ¶ä½œRSS -->

Huginnä½¿ç”¨å¤šä¸ªä¸åŒåŠŸèƒ½çš„Agentç»„åˆæ­é…æ¥å®ç°ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œä¸€ä¸ªAgentå¯ä»¥æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªEventï¼Œä½ å¯ä»¥æŒ‡å®šä»–äº§ç”Ÿçš„Eventç”±å“ªä¸ªAgentæ¥æ”¶å¤„ç†ã€‚

æ¯”å¦‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨WebSite Agentæ¥çˆ¬å–æŸä¸ªç½‘ç«™ä¸Šçš„åˆ—è¡¨å†…å®¹ï¼Œçˆ¬å–ååˆ—è¡¨çš„æ¯ä¸€é¡¹ä¼šç”Ÿæˆä¸€ä¸ªEventï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªOutput Agentæ¥æ¥æ”¶è¿™äº›Eventï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºRSSçš„æ ¼å¼è¿›è¡Œè¾“å‡ºï¼Œå¤åˆ¶Output Agentè¿”å›ç»™ä½ çš„URLå°±å¯ä»¥è¿›è¡Œè®¢é˜…å•¦ï¼ŒHuginnçˆ¬å–ç½‘ç«™ç”ŸæˆRSSçš„åŸºæœ¬åŸç†å°±æ˜¯è¿™æ ·ã€‚

## Huginnçˆ¬å–æ™®é€šç½‘é¡µåˆ¶ä½œRSS



å³é”®ç½‘é¡µæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå±å¹•ä¼šåˆ†å‡ºä¸€éƒ¨åˆ†ç©ºé—´æ˜¾ç¤ºå¼€å‘è€…å·¥å…·çª—å£ï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„æŒ‰é’®å†æŠŠé¼ æ ‡ç§»åŠ¨åˆ°é¡µé¢ä¸Šå¯ä»¥é€‰æ‹©é¡µé¢çš„æŸä¸€ä¸ªå…ƒç´ ï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘ä»¬è¦çˆ¬å–æ¨èæ–‡ç« åˆ—è¡¨ï¼Œæ¨èæ–‡ç« åˆ—è¡¨çš„æ¯ä¸€é¡¹éƒ½æœ‰åŒæ ·çš„æ ·å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨CSSé€‰æ‹©å™¨æ¥æŒ‡å®šçˆ¬å–è¯¥é¡¹

![image-20220508160659378](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207138.png)



è¯¥å…ƒç´ å¯ä»¥ç”¨CSSé€‰æ‹©å™¨`.meiwen`é€‰æ‹©åˆ°ã€‚

**Tips:** class=xxxåˆ™ä½¿ç”¨`.xxx`,å¦‚æœä¸ºid=xxxåˆ™ä½¿ç”¨`#xxx`

è¯¥æ ‡ç­¾æ˜¯aæ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­é™å®šä¸€ä¸‹æ¡ä»¶ï¼Œä½¿ç”¨`a.meiwen`

å¦‚æœè¦é™åˆ¶å¿…é¡»æ˜¯h2 æ ‡ç­¾ä¸‹çš„å¸¦æœ‰meiwençš„classå±æ€§çš„aæ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨`h2 a.meiwen`

å¦‚æœè¦å†åŠ ä¸€ä¸ªé™åˆ¶ï¼Œæ˜¯åˆ—è¡¨å…ƒç´ liä¸‹é¢çš„h2æ ‡ç­¾é‡Œå¸¦æœ‰meiwençš„classå±æ€§çš„aæ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨`li h2 a.meiwen`

æ·»åŠ å…¶ä»–é™„åŠ é™å®šæ¡ä»¶ä»¥æ­¤ç±»æ¨

ä½ ä¹Ÿå¯ä»¥åœ¨å³ä¾§Styleé¢æ¿é‡Œç‚¹å‡»åŠ å·æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰æ ·å¼ï¼Œè¾“å…¥CSSé€‰æ‹©å™¨ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨é«˜äº®ç¬¦åˆæ¡ä»¶çš„ç½‘é¡µå…ƒç´ ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ¥æ£€éªŒä½ å†™çš„CSSé€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®ä»¥åŠæ˜¯ä¸æ˜¯æå–çš„ä½ æƒ³è¦çš„å†…å®¹

![image-20220508163359806](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207716.png)





æ¥ä¸‹æ¥åœ¨Huginné‡Œåˆ›å»ºä¸€ä¸ªScenarioï¼Œç„¶åç‚¹å‡»æ–°å»ºä¸€ä¸ªAgentï¼Œç±»å‹é€‰æ‹©WebSite Agentï¼Œå¡«å†™ä¸€ä¸ªåç§°ï¼Œå¹¶åœ¨æœ€ä¸‹é¢çš„é…ç½®å¤„æŒ‡å®šä½ è¦çˆ¬å–çš„ç½‘é¡µå…ƒç´ 

> ###### **Website Agent**
>
> The Website Agent scrapes a website, XML document, or JSON feed and creates Events based on the results.

```json
url: {
	css: li h2 a.meiwen
	value: @href
}
```

ä»¥çˆ¬å–urlä¸ºä¾‹ï¼Œcssè¡¨ç¤ºä½¿ç”¨cssé€‰æ‹©å™¨é€‰æ‹©ç½‘é¡µå…ƒç´ ï¼Œvalueè¡¨ç¤ºä»å“ªé‡Œè·å–å¯¹åº”çš„å€¼ï¼Œå¯¹äºåˆšæ‰æˆ‘ä»¬é€‰å–çš„ä¸€ä¸ªå…ƒç´ æ¥è¯´

```html
<a class="meiwen" href="/article/58030.html" title="ç¼˜èµ·åˆ™èšï¼Œç¼˜ç­åˆ™æ•£">ç¼˜èµ·åˆ™èšï¼Œç¼˜ç­åˆ™æ•£</a>
```

hrefå±æ€§é‡Œé¢çš„å†…å®¹æ˜¯ä»–çš„é“¾æ¥ï¼Œtitleå±æ€§é‡Œé¢çš„å†…å®¹åˆ™æ˜¯ä»–çš„æ ‡é¢˜ã€‚æ¥ä¸‹æ¥åœ¨valueä¸­å¡«å†™`@href`æŒ‡å®šä»hrefå±æ€§æå–å†…å®¹ï¼Œå°±å¯ä»¥å–åˆ°é“¾æ¥åœ°å€äº†

> **Pro Tips:**
>
> å¦‚æœæ˜¯çº¯æ–‡æœ¬èŠ‚ç‚¹æˆ–æ˜¯æƒ³æå–æ ‡ç­¾å†…åµŒçš„æ–‡æœ¬ï¼Œvalueé‡Œå¯ä»¥å¡«å†™`string(.)`
>
> å¦‚æœæƒ³åˆ é™¤å¤šä½™çš„ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨`normalize-space(.)`

> **Pro Tips 2:**
>
> å­—ç¬¦ä¸²å¤„ç†å‡½æ•°å’Œæ ‡ç­¾å±æ€§å€¼å˜é‡å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚`normalize-space(@title)`å¯ä»¥è·å–è¯¥æ ‡ç­¾çš„titleå±æ€§å€¼å¹¶åˆ é™¤å¤šä½™çš„ç©ºç™½å­—ç¬¦

![image-20220508163714342](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207717.png)

æ¥ä¸‹æ¥ç‚¹å‡»Dry RunæŒ‰é’®è¿›è¡Œæµ‹è¯•ï¼Œä¸å‡ºæ„å¤–æˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªjsonçš„è¾“å‡ºï¼Œé‡Œé¢åŒ…æ‹¬æˆ‘ä»¬çˆ¬å–åˆ°çš„æ¯ä¸€é¡¹ä»–çš„urlå’Œtitleã€‚

å¦‚æœæ²¡æœ‰æˆåŠŸï¼Œä½ å¯èƒ½éœ€è¦åˆ æ‰ä¸Šé¢æ²¡æœ‰ä½¿ç”¨åˆ°çš„hovertextèŠ‚ç‚¹ï¼Œå› ä¸ºè¯¥é¡¹æŒ‡å®šçš„å†…å®¹åœ¨æˆ‘ä»¬åˆšæ‰çš„ç½‘é¡µä¸­å¹¶ä¸å­˜åœ¨ã€‚

![image-20220508164259295](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207718.png)



ç‚¹å‡»Saveä¿å­˜ï¼Œæˆ‘ä»¬å¼€å§‹ä¸‹ä¸€æ­¥è¾“å‡ºRSSã€‚åœ¨åˆšæ‰çš„Scenarioä¸­å†æ–°å»ºä¸€ä¸ªAgentï¼Œé€‰æ‹©Data Output Agentï¼Œå¹¶è®¾ç½®ä»–çš„åå­—å’ŒSource Agent

> ###### Data output Agent
>
> The Data Output Agent outputs received events as either RSS or JSON. Use it to output a public or private stream of Huginn data.

![image-20220508164941647](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207719.png)



**Propagate immediately**æ˜¯æŒ‡å³æ—¶å¤„ç†æ¥è‡ªSource Agentçš„Eventï¼Œå¯ç”¨ä»–æ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•ï¼Œä½†ä¼šç•¥å¾®å¢åŠ æœåŠ¡å™¨è´Ÿè½½ï¼Œä½ å¯ä»¥è‡ªè¡Œå†³å®šæ˜¯å¦ä½¿ç”¨ã€‚

![image-20220508165345792](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207720.png)

åœ¨secretå­—æ®µä¸­ä¸ºä½ çš„è¿™ä¸ªRSSæ ‡æ³¨ä¸€ä¸ªè‹±æ–‡çš„åå­—ï¼Œä¿®æ”¹titleå­—æ®µæ ‡æ³¨ä½ çš„RSSçš„åå­—ã€‚itemå­—æ®µæ˜¯æ¯æ¡æ–‡ç« ä¼šæœ‰çš„å±æ€§ï¼Œä¸€èˆ¬æ¥è¯´ä¸»è¦å°±titleå’Œlinkï¼Œåˆ†åˆ«è®¾ç½®ä¸ºä¸Šæ–‡æˆ‘ä»¬æå–çš„å€¼çš„å˜é‡åã€‚è¿™é‡Œæ·»åŠ ä¸€ä¸ªguidå­—æ®µï¼Œè¿™æ˜¯ä¸€ç¯‡æ–‡ç« çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé¿å…RSSé˜…è¯»å™¨è¯»åˆ°çš„æ–‡ç« æ ‡é¢˜ä¸åŒä½†æ˜¯å†…å®¹ç›¸åŒï¼Œå¸¸è§äºæŸç¯‡æ–‡ç« çš„æ ‡é¢˜è¢«ä¿®æ”¹ï¼Œè¿™ä¼šå¯¼è‡´RSSé˜…è¯»å™¨å†…å‡ºç°å¤šç¯‡é‡å¤æ–‡ç« ã€‚

æ­¤å¤–å»ºè®®å¢åŠ ä¸€ä¸ªlinkå­—æ®µï¼Œå€¼è®¾ç½®ä¸ºä¸çˆ¬å–çš„ç½‘ç«™çš„ä¸»åŸŸåä¸€è‡´ï¼Œé¿å…ç½‘ç«™å†…ä½¿ç”¨ç›¸å¯¹é“¾æ¥å¼€å¤´çš„èµ„æºæ— æ³•æ­£å¸¸åŠ è½½ã€‚

![image-20220508170038722](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207721.png)



![image-20220508170115192](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207722.png)

ç‚¹å‡»Saveä¿å­˜ï¼Œå›åˆ°Scenarioç•Œé¢ï¼Œç¬¬ä¸€æ¬¡éœ€è¦æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œä¸€ä¸‹åˆšæ‰çš„Website Agentã€‚ç¨ç­‰ç‰‡åˆ»åå°ä¼šè¿›è¡Œçˆ¬å–ï¼Œå³ä¸Šè§’ä¼šæ˜¾ç¤ºäº§ç”Ÿäº†å¤šå°‘ä¸ªEventã€‚å†ç‚¹å¼€åˆšæ‰è®¾ç½®çš„Data Output AgentæŸ¥çœ‹è¯¦æƒ…ï¼Œvolaï¼å³ä¾§å°±ä¼šæ˜¾ç¤ºç”Ÿæˆçš„RSSé“¾æ¥äº†ï¼Œå¤åˆ¶ä»¥xmlç»“å°¾çš„é“¾æ¥åˆ°RSSé˜…è¯»å™¨ä¸­å°±å¯ä»¥è®¢é˜…å•¦ğŸ‰

![image-20220508170212112](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207723.png)





å¦‚æœä½ çš„é…ç½®æ­£ç¡®ä½†æ˜¯WebSite Agentåˆæ²¡æœ‰è¾“å‡ºä»»ä½•å†…å®¹çš„è¯ï¼Œé‚£ä¹ˆä½ è¦çˆ¬å–çš„ç«™ç‚¹çš„å†…å®¹åº”è¯¥æ˜¯é€šè¿‡JavaScriptåœ¨ä½ å¸¦å¼€æµè§ˆå™¨æ—¶åŠ¨æ€ç”Ÿæˆçš„ã€‚

> **Pro Tips:**
>
> ä½ å¯ä»¥å³é”®ç½‘é¡µåœ¨å¼€å‘äººå‘˜èœå•ä¸­ç‚¹å‡»æ˜¾ç¤ºæºä»£ç ï¼Œç„¶åç”¨Ctrl+Fæœç´¢ä½ åœ¨é¡µé¢ä¸Šè§åˆ°çš„æƒ³çˆ¬å–çš„æŸä¸€æ¡å†…å®¹ï¼Œå¦‚æœæœ‰è¯´æ˜è¯¥ç½‘ç«™çš„é¡µé¢æ—¶é™æ€çš„ï¼Œå¦åˆ™è¯´æ˜ä½ è¦çˆ¬å–çš„å†…å®¹å¹¶ä¸æ˜¯é™æ€çš„ã€‚

è¦çˆ¬å–è¿™æ ·çš„ç«™ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œï¼Œæ‰§è¡Œé¡µé¢ä¸Šçš„JavaScriptè„šæœ¬ï¼Œå¾…æ•°æ®ç”Ÿæˆå®Œæ¯•åå†ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•å»çˆ¬å–å†…å®¹ã€‚è¦æ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œï¼Œè¿™é‡Œä»‹ç»ä¸¤ä¸ªæ–¹æ¡ˆï¼šä¸€ä¸ªæ˜¯åˆ©ç”¨browserlessçš„æ— å¤´æµè§ˆå™¨ï¼Œå¦ä¸€ä¸ªæ˜¯ä½¿ç”¨åœ¨çº¿PhatomJSæœåŠ¡ã€‚



## ä½¿ç”¨Huginn+Browserlessä¸ºåŠ¨æ€ç½‘é¡µç”ŸæˆRSS



éƒ¨ç½²äº†[RSS Man X](https://github.com/Colin-XKL/RSSmanX)çš„å®Œæ•´ç‰ˆçš„è¯é»˜è®¤å·²ç»åŒ…å«huginnå’ŒbrowserlessæœåŠ¡ï¼Œæ— éœ€é‡å¤å®‰è£…ã€‚ä¸”huginnå¯ä»¥é€šè¿‡`service.browserless:3000`è®¿é—®åˆ°browserlessæœåŠ¡ã€‚

æ€»ä½“æ­¥éª¤ä¸ä¸Šæ–‡ä¸€æ ·ï¼Œä¸è¿‡å› ä¸ºè¢«æŠ“å–çš„å†…å®¹æ˜¯é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆçš„ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨WebSite Agentæ˜¯æŠ“å–ä¸åˆ°ä¸œè¥¿çš„ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä½¿ç”¨Post Agentå‘browserlessæœåŠ¡å‘é€æŒ‡ä»¤ï¼Œè®©ä»–å¸®æˆ‘ä»¬æ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œï¼Œå†å°†æœ€ç»ˆå®Œæ•´çš„ç½‘é¡µè¿”å›ç»™æˆ‘ä»¬ï¼Œå†ä½¿ç”¨WebSite Agentè¿›è¡Œåç»­å¤„ç†ã€‚

> ###### **Post Agent**
>
> A Post Agent receives events from other agents (or runs periodically), merges those events with the Liquid-interpolated contents of payload, and sends the results as POST (or GET) requests to a specified url. To skip merging in the incoming event, but still send the interpolated payload, set no_merge to true.

æ¥ä¸‹æ¥ä»¥[è¿™ä¸ªç½‘ç«™](https://pccz.court.gov.cn/pcajxxw/pcgg/ggdh?lx=0)ä¸ºä¾‹ä»‹ç»ä¸€ä¸‹ï¼Œè¿™ä¸ªåˆ—è¡¨é¡µçš„å†…å®¹æ˜¯ç”±JavaScriptåŠ¨æ€ç”Ÿæˆçš„

![image-20220508205159783](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207724.png)

æŒ‰ç…§ä»¥ä¸‹å†…å®¹è®¾ç½®ä½ çš„Post Agent

```json
{
  "post_url": "http://service.browserless:3000/content",
  "expected_receive_period_in_days": "1",
  "content_type": "json",
  "method": "post",
  "payload": {
    "url": "https://pccz.court.gov.cn/pcajxxw/pcgg/ggdh?lx=0"
  },
  "headers": {
    "Cache-Control": "no-cache",
    "Content-Type": "application/json"
  },
  "emit_events": "true",
  "no_merge": "false",
  "output_mode": "clean"
}
```

å…¶ä¸­`post_url`ä¸ºä½ çš„browserlesså®ä¾‹åœ°å€ï¼Œå¦‚æœä½ ä½¿ç”¨äº†RSS MAN Xé‡Œçš„Huginnå¯ä»¥ç›´æ¥å‘ä¸Šé¢ä¸€æ ·å¡«å†™ã€‚`payload`ä¸­çš„`url`å­—æ®µå¡«å†™ä½ éœ€è¦çš„ç½‘é¡µåœ°å€ã€‚æ³¨æ„emit_eventsè¦è®¾ç½®ä¸º`true`ï¼Œè¿™æ ·æ‰æ–¹ä¾¿æˆ‘ä»¬åç»­ä½¿ç”¨WebSite Agentæ“ä½œã€‚

ç‚¹å‡»Dry Runï¼Œå¦‚æœèƒ½è¿”å›ä¸€ä¸ªå¸¦æœ‰`body`å­—æ®µä¸”é‡Œé¢æœ‰æ–‡æœ¬å†…å®¹è¯´æ˜è°ƒç”¨æˆåŠŸã€‚

è°ƒç”¨ä¸æˆåŠŸæ£€æŸ¥ä¸€ä¸‹é…ç½®ï¼Œä»¥åŠæ˜¯ä¸æ˜¯æˆ‘ä»¬çš„çˆ¬è™«è¢«ç›®æ ‡ç½‘ç«™æ‹¦æˆªäº†ã€‚è‹¥æ˜¯çˆ¬è™«è¢«æ‹¦æˆªå¯å‚è€ƒæ–‡æœ«çš„è§£å†³æ–¹æ¡ˆã€‚

![image-20220508195731732](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207725.png)

æ¥ä¸‹æ¥ç‚¹å‡»Saveä¿å­˜ï¼Œå†æ–°å»ºä¸€ä¸ªWebsite Agentï¼ŒSourceè®¾ç½®ä¸ºåˆšæ‰çš„Post Agentã€‚

```json
{
  "expected_update_period_in_days": "2",
  "data_from_event": "{{ body }}",
  "type": "html",
  "mode": "on_change",
  "extract": {
    "url": {
      "css": "ul#wslb li a",
      "value": "normalize-space(@href)"
    },
    "title": {
      "css": "ul#wslb li a",
      "value": "@title"
    },
    "author": {
      "css": "ul#wslb li div.center",
      "value": "normalize-space(.)"
    }
  }
}
```



æ³¨æ„ä¿®æ”¹`data_from_event`çš„å€¼ï¼Œå…¶ä»–åœ°æ–¹ä¸çˆ¬å–æ™®é€šç½‘ç«™ä¸€æ ·ã€‚å†æ–°å»ºå¹¶é…ç½®ä¸€ä¸‹Output Agentï¼ŒRSSçš„é“¾æ¥å°±å‡ºæ¥äº†

![image-20220508205856407](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207726.png)



## ä½¿ç”¨PhantomJSä¸ºåŠ¨æ€é¡µé¢ç”ŸæˆRSS

é¦–å…ˆéœ€è¦åˆ°[Phantom Js Cloudçš„å®˜ç½‘](https://phantomjscloud.com)æ³¨å†Œä¸€ä¸ªè´¦æˆ·ï¼Œæ¯ä¸ªè´¦æˆ·å®˜æ–¹æä¾›äº†ä¸€å®šçš„å…è´¹é¢åº¦ï¼Œæ¯å¤©å¤§æ¦‚å¯ä»¥çˆ¬å–500ä¸ªé¡µé¢ï¼Œå¯¹äºåšRSSæ¥è¯´å¦¥å¦¥çš„å¤Ÿç”¨äº†ã€‚æ³¨å†Œä¹‹åå¯ä»¥å¾—åˆ°ä¸€ä¸ªAPI KEYï¼Œè¿™ä¸ªå¾…ä¼šä¼šä½¿ç”¨åˆ°ã€‚

æ¥ä¸‹æ¥æ–°å»ºä¸€ä¸ªPhantom JS Cloud Agentï¼Œå¡«å†™åŸºæœ¬çš„åç§°ã€API KEYå’Œç›®æ ‡URLï¼Œrender typeé€‰æ‹©htmlã€‚åº•ä¸‹User Agentå»ºè®®æ”¹ç”¨çœŸå®çš„æµè§ˆå™¨UAï¼Œå‡å°‘è§¦å‘åçˆ¬è™«çš„å¯èƒ½æ€§ã€‚å¦‚æœä¸çŸ¥é“è‡ªå·±çš„UAå¯ä»¥åˆ°è¿™ä¸ªç½‘ç«™æŸ¥çœ‹å½“å‰æµè§ˆå™¨çš„UAï¼Œå¤åˆ¶å­—ç¬¦ä¸²å³å¯ã€‚å¦‚æœæ‡’å¾—æŸ¥ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ª

```
Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.81 Safari/537.36
```

> ###### Phantom JS Cloud Agent
>
> This Agent generates PhantomJs Cloud URLs that can be used to render JavaScript-heavy webpages for content extraction.
>
> URLs generated by this Agent are formulated in accordance with the PhantomJs Cloud API. The generated URLs can then be supplied to a Website Agent to fetch and parse the content. Sign up to get an api key, and add it in Huginn credentials.

ç‚¹å‡»Dry Runåä¼šè¿”å›ä¸€æ¡urlï¼Œè¿”å›æ ¼å¼ç±»ä¼¼è¿™æ ·

```json
[
  {
    "url": "https://phantomjscloud.com/api/browser/xxxxxxx"
  }
]
```

ä¹‹ååˆ›å»ºä¸€ä¸ªWebSite Agentï¼ŒSource Agentè®¾ç½®ä¸ºä¸Šé¢çš„Phantom JS Cloud Agentï¼Œç„¶åç¨å¾®æ”¹ä¸€ä¸‹urlçš„éƒ¨åˆ†

```json
{
  "expected_update_period_in_days": "2",
  "url_from_event": "{{url}}",
  "type": "html",
  "mode": "on_change",
  "extract": {...}
}  
```

æ³¨æ„å°†åŸæ¥çš„`url:??`çš„éƒ¨åˆ†æ›´æ”¹ä¸º`"url_from_event": "{{url}}"`,è¿™æ ·å°±æŒ‡å®šä½¿ç”¨Phantom JS Cloudä¸ºæˆ‘ä»¬è·å–çš„å®Œæ•´ç½‘é¡µï¼Œæ¥ä¸‹æ¥çš„æ“ä½œå°±å¤§åŒå°å¼‚äº†ã€‚é…ç½®å¥½è¦çˆ¬å–çš„å­—æ®µå’Œè§„åˆ™åç‚¹å‡»Dry Runå°±å¯ä»¥çœ‹åˆ°ç»“æœ

![image-20220508215636780](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207727.png)



è¿™é‡Œæ˜¯åˆšæ‰çš„Agentäº§ç”Ÿçš„ä¸€ä¸ªEventã€‚è¿™é‡Œé™¤äº†urlå’Œtitleæˆ‘è¿˜æå–äº†dateå­—æ®µã€‚åœ¨Output Agentä¸­ï¼Œå¯ä»¥é…ç½®ä¸ºæ¯ä¸€æ¡æ–‡ç« è¾“å‡ºå‘å¸ƒæ—¶é—´çš„ä¿¡æ¯ã€‚å¯¹äºè¿™ç§è§„æ•´çš„æ—¥æœŸå­—æ¯ä¸²ï¼Œå¯ä»¥ä½¿ç”¨`{{ date | date: %F }}`è¿›è¡Œè§£æå¹¶æ ¼å¼åŒ–è¾“å‡ºä¸ºrssè§„èŒƒçš„æ—¶é—´æ ¼å¼å¦‚æœæ²¡æœ‰é…ç½®çš„è¯ï¼Œæ¯ç¯‡æ–‡ç« çš„å‘å¸ƒæ—¶é—´æ˜¾ç¤ºçš„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸ºHuginnçˆ¬è™«æ›´æ–°çš„æ—¶é—´ã€‚

```json
"item": {
      "title": "{{title}}",
      "link": "{{url}}",
      "pubDate": "{{ date | date: %F }}"
    },
```

> **Pro Tips:**
>
> Huginnè§£ææ—¥æœŸ
>
> æ³¨æ„`{{ date | date: %F }}`é‡Œé¢ï¼Œç¬¬ä¸€ä¸ª`date`æ˜¯ä¸Šé¢çš„Website Agentäº§ç”Ÿçš„Eventé‡Œé¢çš„å˜é‡åï¼Œç¬¬äºŒä¸ª`date`æ˜¯Huginnä½¿ç”¨çš„Liquidæ¨¡ç‰ˆå¼•æ“è¯­æ³•é‡Œå†…ç½®çš„ä¸€ä¸ªfilterï¼Œå¯ä»¥ç†è§£ä¸ºæœ‰ç‰¹å®šåŠŸèƒ½çš„å‡½æ•°





![image-20220508220438696](https://blog-1301127393.file.myqcloud.com/BlogImgs/202205082207637.png)





## FAQ

* **ä¸ºä»€ä¹ˆå¯åŠ¨dockerå®¹å™¨åè®¿é—®Huginnæ˜¾ç¤ºç½‘ç»œé”™è¯¯ï¼Ÿ**

  Huignnå†·å¯åŠ¨è¾ƒæ…¢ï¼Œéœ€è¦ç­‰å¾…ä¸‰äº”åˆ†é’Ÿã€‚å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œæ£€æŸ¥ç«¯å£æ˜ å°„å’Œé˜²ç«å¢™è®¾ç½®

* **ä¸ºä»€ä¹ˆæŠ“å–åˆ°çš„åŒ…å«ç›¸å¯¹è·¯å¾„çš„ç»“æœï¼Œç½‘é¡µä¸Šå¯ä»¥ç‚¹å‡»è®¿é—®ï¼Œä½†æ˜¯ç”Ÿæˆçš„RSSä¸èƒ½æ­£å¸¸ä½¿ç”¨ï¼Ÿ**

  æ£€æŸ¥linkçš„è®¾ç½®ï¼Œæœ‰äº›ç½‘ç«™åªæ˜¯åŸŸåï¼Œæœ‰äº›ç½‘ç«™æœ‰å­ç›®å½•ï¼Œå…·ä½“æŸ¥çœ‹è¯¥ç½‘é¡µæºç ä¸­headèŠ‚ç‚¹é‡Œbase urlçš„è®¾ç½®

* **å¦‚ä½•å¯¹çˆ¬å–åˆ°çš„æŸä¸€é¡¹çš„å­—ç¬¦ä¸²åšæ›´é«˜çº§æ›´å¤æ‚çš„å¤„ç†ï¼Ÿ**

  å¯ä»¥å‚è€ƒ[Hugnnå®˜æ–¹å¯¹Liquidè¯­æ³•çš„æ–‡æ¡£](https://github.com/huginn/huginn/wiki/Formatting-Events-using-Liquid)ä»¥åŠ[Shopifyå®˜æ–¹å…³äºLiquidæ¨¡æ¿çš„è¯­æ³•æ–‡æ¡£](https://shopify.dev/api/liquid)

* **ä¸ºä»€ä¹ˆéƒ¨ç½²äº†Huginnï¼Œç­‰äº†å¾ˆé•¿æ—¶é—´éƒ½æ— æ³•è®¿é—®åå°é¡µé¢ï¼Ÿ**

  è‹¥éƒ¨ç½²åæŸä¸ªåº”ç”¨ä¸€ç›´æ— æ³•é€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè¯·æ£€æŸ¥æ˜¯å¦ç»‘å®šåˆ°äº†6000/6666ç­‰ç‰¹æ®Šç«¯å£ï¼Œæµè§ˆå™¨ä¼šæ‹¦æˆªå¯¹è¿™äº›ç«¯å£çš„è®¿é—®å‚è§[è¿™é‡Œ](https://blog.colinx.one/posts/docker-compose%E7%9A%84%E9%94%99%E8%AF%AF%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/)

* **Huginn çˆ¬è™«è®¿é—®ç›®æ ‡ç½‘ç«™è¢«æ‹¦æˆªäº†æ€ä¹ˆè§£å†³**  
  ä»‹ç»å‡ ä¸ªåŸºæœ¬çš„ååçˆ¬è™«ç­–ç•¥ï¼š
  1. å¸¦ä¸ŠUser Agentï¼Œè¦æ±‚æ˜¯çœŸå®çš„æµè§ˆå™¨UAã€‚
  2. Browserlesså»æ‰é»˜è®¤ä¼šå’Œè¯·æ±‚ä¸€èµ·å‘é€çš„å¯ä»¥è¢«è¯†åˆ«ä¸ºçˆ¬è™«çš„ç‰¹å¾å‚æ•°ï¼Œè®¾ç½®browserlessçš„ç¯å¢ƒå˜é‡`DEFAULT_HEADLESS=false`
  3. ä½¿ç”¨éšæœºä»£ç†IPï¼Œé€‚ç”¨äºå› çˆ¬å–é¢‘ç‡è¾¾åˆ°çˆ¬è™«é˜ˆå€¼


## æ‰©å±•é˜…è¯»

* [Huginnå®˜æ–¹æ–‡æ¡£](https://github.com/huginn/huginn/wiki/)
* [Liquidæ¨¡æ¿å¼•æ“è¯­æ³•å®˜æ–¹æ–‡æ¡£](https://shopify.dev/api/liquid/filters/)
* [RSS Man Xéƒ¨ç½²æŒ‡å—](https://blog.colinx.one/posts/rssmanx%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97/)
* [docker compose çš„é”™è¯¯ä½¿ç”¨å§¿åŠ¿](https://blog.colinx.one/posts/docker-compose%E7%9A%84%E9%94%99%E8%AF%AF%E4%BD%BF%E7%94%A8%E5%A7%BF%E5%8A%BF/)

